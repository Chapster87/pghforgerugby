var PG8={};(function(t,e,n,i){"use strict";if("undefined"!=typeof PG8Data){var a=n.history.location||n.location,s=this.PageLoader=function(e){this.thisLink=a.href,this.nextLink=PG8Data.nextLink,this.thisPage=parseInt(PG8Data.startPage,10),this.nextPage=this.thisPage+1,this.maxPages=parseInt(PG8Data.maxPages,10),this.maxedOut=0,this.opts=t.extend({},t.fn.ajaxPageLoader.defaults,e),this.content=t(this.opts.content),this.nextPage<=this.maxPages&&this.init()};s.prototype={init:function(){this.content.children().wrapAll('<div id="content-page-'+this.thisPage+'" class="clear" data-href="'+this.thisLink+'"></div>'),this.holder(),this.handler(),this.spinner()},holder:function(){this.content.append('<div id="content-page-'+this.nextPage+'" class="clear" data-href="'+this.nextLink+'"></div>')},handler:function(){var i=this,a=t(n);t("body").on("click",i.opts.next,function(e){i.nextPage<=i.maxPages&&(e.preventDefault(),t(this).parents("nav:first").before(t("#spinner").show()),i.loader(i.nextPage,i.nextLink))}),a.on("scroll",this.content,function(n){clearTimeout(t.data(this,"pushTimer")),clearTimeout(t.data(this,"infinTimer")),t.data(this,"pushTimer",setTimeout(function(){var e=i.content.children(":first"),n=e.offset().top,s=e.data("href"),o=a.scrollTop();n>=o?i.pusher(s):i.content.children().each(function(){var e=t(this),n=e.offset().top-i.opts.scrollOffset,a=e.outerHeight()+n;o>=n&&a>o&&i.pusher(e.data("href"))})},i.opts.pushDelay)),0===i.maxedOut&&i.opts.infinScroll===!0&&t.data(this,"infinTimer",setTimeout(function(){var n=t(e),s=n.height(),o=a.height()+a.scrollTop(),r=i.content.children(":last").offset().top,h=s-o;o>r+i.opts.scrollOffset&&o<=r+i.opts.scrollOffset+i.opts.infinOffset&&h>=i.opts.infinFooter&&t(i.opts.next).trigger("click")},i.opts.infinDelay))})},spinner:function(){t.isFunction(n.Spinner)&&(this.content.after('<div id="spinner" style="position: relative;"></div>'),t("#spinner").spin(this.opts.spinOpts).hide())},pusher:function(t){"undefined"!=typeof t&&t!==a.href&&history.pushState(null,null,t)},loader:function(e,n){var i=this;t("#content-page-"+e).load(n+" "+i.opts.content+" > *",function(){var s=t(i.opts.next);i.thisPage=e,i.thisLink=n,i.nextPage=e+1,i.nextLink=n.replace(/\/page\/[0-9]*/,"/page/"+i.nextPage),i.pusher(i.thisLink),i.holder(),i.nextPage>i.maxPages?(s.remove(),i.maxedOut=1):s.is("[href]")?s.attr("href",i.nextLink):t("[href]",s).attr("href",i.nextLink),t("#spinner").hide(),t(i.opts.prev).hide(),i.loaded(),i.scroll(),i.analytics("/"+a.href.replace(i.root(),""))})},loaded:function(){var t=e.createEvent("Event");t.initEvent("DOMContentLoaded",!0,!0),n.document.dispatchEvent(t)},scroll:function(){var e=t("#content-page-"+this.thisPage).children(":first").offset().top-this.opts.scrollOffset;t("body, html").animate({scrollTop:e},this.opts.scrollDelay,"swing")},analytics:function(t){"undefined"!=typeof n.ga?n.ga("send","pageview",t):"undefined"!=typeof n._gaq&&n._gaq.push(["_trackPageview",t])},root:function(){var t=e.location.port?":"+e.location.port:"",n=e.location.protocol+"//"+(e.location.hostname||e.location.host)+t+"/";return n}},t.fn.ajaxPageLoader=function(e){return this.each(function(){t.data(this,"ajaxPageLoader")||t.data(this,"ajaxPageLoader",new s(e))})},t.fn.ajaxPageLoader.defaults={content:"main",next:".next-page",prev:".prev-page",scrollDelay:300,scrollOffset:30,pushDelay:250,infinScroll:!0,infinDelay:600,infinOffset:300,infinFooter:1,spinOpts:{lines:25,length:0,width:4,radius:25,speed:1.5,trail:40,top:"15px"}}}}).apply(PG8,[jQuery,document,window]);